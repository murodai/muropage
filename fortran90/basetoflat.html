<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>~/Desktop/fortran/base_to_flat/basetoflat.f90.html</title>
<meta name="Generator" content="Vim/9.1">
<meta name="plugin-version" content="vim9.0_v2">
<meta name="syntax" content="fortran">
<meta name="settings" content="use_css,no_foldcolumn,expand_tabs,pre_wrap,prevent_copy=,use_input_for_pc=none">
<meta name="colorscheme" content="solarized">
<style>
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #657b83; background-color: #fdf6e3; }
body { font-family: monospace; color: #657b83; background-color: #fdf6e3; }
* { font-size: 1em; }
a { color: inherit; }
.Comment { color: #93a1a1; font-style: italic; }
.Statement { color: #719e07; }
.PreProc { color: #cb4b16; }
.Type { color: #b58900; }
.Identifier { color: #268bd2; }
.Constant { color: #2aa198; }
-->
</style>
</head>
<body>
<pre id='vimCodeElement'>
<span class="PreProc">program</span> <span class="Identifier">basis_to_flat</span>
<span class="Type">implicit none</span>
<span class="Type">integer</span>(<span class="Constant">8</span>),<span class="Type">parameter</span>::par <span class="Statement">=</span> <span class="Constant">500</span>
<span class="Type">integer</span>(<span class="Constant">8</span>) i,j,k,l,n,m,nb,rk,binom,non
<span class="Type">integer</span>(<span class="Constant">8</span>) s(par),b(par),c(par,par),d(par),e(par,par),f(par,par,par),nf(par,par,par),g(par,par),h(par,par),sr(par)
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'台集合の大きさn=?'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)n
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'与える基底の個数=?'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)nb
<span class="Comment">!基底族を定める。b(j)が与えた基底を表す。</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'与える基底を記述する。'</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'例　{1,2,4}　→　1101'</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, nb
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)i,<span class="Constant">'つ目'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Constant">'(b32.32)'</span>)b(i)
<span class="Statement">enddo</span>
<span class="Comment">!階数を計算する。</span>
rk <span class="Statement">=</span> <span class="Constant">0</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, n
    <span class="Statement">if</span> (<span class="Identifier">iand</span>(b(<span class="Constant">1</span>),<span class="Constant">2</span><span class="Statement">**</span>(i<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">==</span> <span class="Constant">2</span><span class="Statement">**</span>(i<span class="Statement">-</span><span class="Constant">1</span>)) rk <span class="Statement">=</span> rk <span class="Statement">+</span> <span class="Constant">1</span>
<span class="Statement">enddo</span>
m <span class="Statement">=</span> <span class="Constant">2</span><span class="Statement">**</span>n
s(<span class="Constant">1</span>) <span class="Statement">=</span> <span class="Constant">0</span>  <span class="Comment">!s(i)が部分集合すべてを表す。</span>
<span class="Statement">do</span> i<span class="Statement">=</span> <span class="Constant">2</span>,m
  s(i) <span class="Statement">=</span> s(i<span class="Statement">-</span><span class="Constant">1</span>) <span class="Statement">+</span> <span class="Constant">1</span>
<span class="Statement">end do</span>
<span class="Statement">do</span> i<span class="Statement">=</span> <span class="Constant">1</span>,m  <span class="Comment">!部分集合と基底の共通部分を取る。c(i,j)がs(i)とb(j)の共通部分を表す。</span>
 <span class="Statement">do</span> j<span class="Statement">=</span><span class="Constant">1</span>,nb
   c(i,j) <span class="Statement">=</span> <span class="Identifier">iand</span>(s(i),b(j))
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i<span class="Statement">=</span><span class="Constant">1</span>,m
 <span class="Statement">do</span> j<span class="Statement">=</span><span class="Constant">1</span>,nb
    h(i,j)<span class="Statement">=</span><span class="Constant">0</span>
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i<span class="Statement">=</span><span class="Constant">1</span>,m  <span class="Comment">!独立集合の階数を数える。</span>
 <span class="Statement">do</span> j<span class="Statement">=</span><span class="Constant">1</span>,nb
   <span class="Statement">do</span> l<span class="Statement">=</span><span class="Constant">1</span>,n
     <span class="Statement">if</span> (<span class="Identifier">iand</span>(c(i,j),<span class="Constant">2</span><span class="Statement">**</span>(l<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">==</span> <span class="Constant">2</span><span class="Statement">**</span>(l<span class="Statement">-</span><span class="Constant">1</span>)) h(i,j) <span class="Statement">=</span> h(i,j)<span class="Statement">+</span><span class="Constant">1</span>
   <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i<span class="Statement">=</span><span class="Constant">1</span>,m
  sr(i)<span class="Statement">=</span><span class="Constant">0</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i<span class="Statement">=</span><span class="Constant">1</span>,m  <span class="Comment">!階数を計算する。</span>
 <span class="Statement">do</span> j<span class="Statement">=</span><span class="Constant">1</span>,nb
    <span class="Statement">if</span> (sr(i) <span class="Statement">&lt;=</span> h(i,j)) sr(i) <span class="Statement">=</span> h(i,j)
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
non <span class="Statement">=</span> <span class="Statement">-</span><span class="Constant">1</span>        <span class="Comment">!-1を64bitで考える。</span>
<span class="Statement">do</span> i<span class="Statement">=</span><span class="Constant">1</span>,m  <span class="Comment">!部分集合の補集合を取る。d(i)がs(i)の補集合を表す。</span>
  d(i)<span class="Statement">=</span> <span class="Identifier">ieor</span>(non,s(i))
<span class="Statement">end do</span>
<span class="Statement">do</span> i<span class="Statement">=</span><span class="Constant">1</span>,m  <span class="Comment">!s(i)に補集合の元を加える。</span>
  <span class="Statement">do</span> k<span class="Statement">=</span><span class="Constant">1</span>,n
   <span class="Statement">if</span> (<span class="Identifier">iand</span>(d(i),<span class="Constant">2</span><span class="Statement">**</span>(k<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">==</span> <span class="Constant">2</span><span class="Statement">**</span>(k<span class="Statement">-</span><span class="Constant">1</span>)) e(i,k) <span class="Statement">=</span> s(i)<span class="Statement">+</span><span class="Constant">2</span><span class="Statement">**</span>(k<span class="Statement">-</span><span class="Constant">1</span>)
   <span class="Statement">if</span> (<span class="Identifier">iand</span>(d(i),<span class="Constant">2</span><span class="Statement">**</span>(k<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">/=</span> <span class="Constant">2</span><span class="Statement">**</span>(k<span class="Statement">-</span><span class="Constant">1</span>)) e(i,k) <span class="Statement">=</span> <span class="Constant">0</span>
  <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>,m  <span class="Comment">!e(i,k)と基底との共通部分を取る。</span>
  <span class="Statement">do</span> j<span class="Statement">=</span><span class="Constant">1</span>,nb
   <span class="Statement">do</span> k<span class="Statement">=</span><span class="Constant">1</span>,n
      f(i,j,k) <span class="Statement">=</span> <span class="Identifier">iand</span>(e(i,k),b(j))
  <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>,m
  <span class="Statement">do</span> j<span class="Statement">=</span><span class="Constant">1</span>,nb
   <span class="Statement">do</span> k<span class="Statement">=</span><span class="Constant">1</span>,n
      nf(i,j,k) <span class="Statement">=</span> <span class="Constant">0</span>
  <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>,m  <span class="Comment">!f(i,j,k)の個数を数える。</span>
  <span class="Statement">do</span> j<span class="Statement">=</span><span class="Constant">1</span>,nb
   <span class="Statement">do</span> k<span class="Statement">=</span><span class="Constant">1</span>,n
    <span class="Statement">do</span> l<span class="Statement">=</span><span class="Constant">1</span>,n
      <span class="Statement">if</span> (<span class="Identifier">iand</span>(f(i,j,k),<span class="Constant">2</span><span class="Statement">**</span>(l<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">==</span> <span class="Constant">2</span><span class="Statement">**</span>(l<span class="Statement">-</span><span class="Constant">1</span>)) nf(i,j,k) <span class="Statement">=</span> nf(i,j,k) <span class="Statement">+</span> <span class="Constant">1</span>
    <span class="Statement">enddo</span>
  <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, m
 <span class="Statement">do</span> k <span class="Statement">=</span> <span class="Constant">1</span>, n
   g(i,k) <span class="Statement">=</span> <span class="Constant">0</span>
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i<span class="Statement">=</span><span class="Constant">1</span>,m  <span class="Comment">!階数を計算する。</span>
 <span class="Statement">do</span> j<span class="Statement">=</span><span class="Constant">1</span>,nb
  <span class="Statement">do</span> k<span class="Statement">=</span><span class="Constant">1</span>,n
    <span class="Statement">if</span> (g(i,k) <span class="Statement">&lt;=</span> nf(i,j,k)) g(i,k) <span class="Statement">=</span> nf(i,j,k)
  <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i<span class="Statement">=</span><span class="Constant">1</span>,m
 <span class="Statement">do</span> k<span class="Statement">=</span><span class="Constant">1</span>,n
  <span class="Statement">if</span> (g(i,k) <span class="Statement">==</span> sr(i)) s(i) <span class="Statement">=</span> <span class="Statement">-</span><span class="Constant">1</span>
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">0</span>, rk
<span class="Statement">print</span><span class="Constant">'(A6,I3)'</span>,<span class="Constant">'rank ='</span>,i
 <span class="Statement">do</span> j <span class="Statement">=</span> <span class="Constant">1</span>, m
  <span class="Statement">if</span> ((sr(j) <span class="Statement">==</span> i) <span class="Statement">.and.</span> (s(j) <span class="Statement">/=</span> <span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">print</span><span class="Constant">'(b8.8)'</span>,s(j)
 <span class="Statement">enddo</span>
<span class="Statement">enddo</span>
<span class="PreProc">end program</span> <span class="Identifier">basis_to_flat</span>
<span class="Comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<span class="PreProc">function</span> <span class="Identifier">binom</span>(n,k)
<span class="Type">implicit none</span>
<span class="Type">integer</span>(<span class="Constant">8</span>) binom,n,k,i
<span class="Statement">if</span> (n<span class="Statement">-</span>k <span class="Statement">&gt;</span> k) k <span class="Statement">=</span> n<span class="Statement">-</span>k
binom <span class="Statement">=</span> n
<span class="Statement">do</span> i <span class="Statement">=</span> n<span class="Statement">-</span><span class="Constant">1</span>, k <span class="Statement">+</span> <span class="Constant">1</span>,<span class="Statement">-</span><span class="Constant">1</span>
binom <span class="Statement">=</span> binom <span class="Statement">*</span> i
<span class="Statement">enddo</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, n<span class="Statement">-</span>k
binom <span class="Statement">=</span> binom <span class="Statement">/</span> i
<span class="Statement">enddo</span>
<span class="PreProc">end function</span> <span class="Identifier">binom</span>
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
