<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>~/Desktop/fortran/gen_base/genbase.f90.html</title>
<meta name="Generator" content="Vim/9.1">
<meta name="plugin-version" content="vim9.0_v2">
<meta name="syntax" content="fortran">
<meta name="settings" content="use_css,no_foldcolumn,expand_tabs,pre_wrap,prevent_copy=,use_input_for_pc=none">
<meta name="colorscheme" content="solarized">
<style>
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #657b83; background-color: #fdf6e3; }
body { font-family: monospace; color: #657b83; background-color: #fdf6e3; }
* { font-size: 1em; }
a { color: inherit; }
.Todo { color: #d33682; font-weight: bold; }
.Comment { color: #93a1a1; font-style: italic; }
.Statement { color: #719e07; }
.PreProc { color: #cb4b16; }
.Type { color: #b58900; }
.Special { color: #dc322f; }
.Identifier { color: #268bd2; }
.Constant { color: #2aa198; }
-->
</style>
</head>
<body>
<pre id='vimCodeElement'>
<span class="PreProc">program</span> <span class="Identifier">gen_base</span>
<span class="Type">implicit none</span>
<span class="Type">integer</span>(<span class="Constant">8</span>),<span class="Type">parameter</span>::par <span class="Statement">=</span> <span class="Constant">800</span>
<span class="Type">integer</span>(<span class="Constant">8</span>) n,t,tmax,nb,nbmin,nbmax,rkmin,rkmax,i,j,k,l,h,d,d1,d2,u
<span class="Type">integer</span>(<span class="Constant">8</span>) s(par),ns(par)
<span class="Type">integer</span>(<span class="Constant">8</span>) factorial,binom
<span class="Type">logical</span>(<span class="Constant">1</span>) z,t1,t2,loopless,c
<span class="Type">real</span> x
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'マトロイドの基底を無作為に生成します。'</span>
<span class="Comment">!!!!! 与える条件</span>
<span class="Comment">!試行回数</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'試行回数の上限?'</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'注:31以下に設定してください。'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)t
tmax <span class="Statement">=</span> <span class="Constant">2</span><span class="Statement">**</span>t<span class="Statement">-</span><span class="Constant">2</span>
<span class="Comment">!台集合の元の個数</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'台集合の元の個数?'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)n
<span class="Comment">!ループの存在を許さないか</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'ループなしにする? T or F'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)loopless
<span class="Comment">!階数の最小値を設けるか</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'階数の最小値を設ける? T or F'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)t1
<span class="Statement">if</span> (t1 <span class="Statement">.eqv.</span> <span class="Constant">.true.</span>) <span class="Statement">then</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'最小値?'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)rkmin
<span class="Statement">endif</span>
<span class="Comment">!階数の最大値を設けるか</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'階数の最大値を設ける? T or F'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)t2
<span class="Statement">if</span> (t2 <span class="Statement">.eqv.</span> <span class="Constant">.true.</span>) <span class="Statement">then</span>
<span class="Statement">write</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)<span class="Constant">'最大値?'</span>
<span class="Statement">read</span>(<span class="Statement">*</span>,<span class="Statement">*</span>)rkmax
<span class="Statement">endif</span>
<span class="Comment">!!!!!!!!!!!!!!!!!!!!!</span>
z <span class="Statement">=</span> <span class="Constant">.false.</span>
<span class="Statement">do</span> t <span class="Statement">=</span> <span class="Constant">1</span>, tmax
 <span class="Statement">call</span> <span class="Identifier">random_number</span>(x)   <span class="Comment">!基底の個数を定める。</span>
 nb <span class="Statement">=</span> <span class="Identifier">int</span>(x<span class="Statement">*</span>binom(n,n<span class="Statement">/</span><span class="Constant">2</span>)) <span class="Statement">+</span> <span class="Constant">1</span>
 <span class="Statement">if</span> (nb <span class="Statement">&gt;</span> par) <span class="Statement">cycle</span>
 <span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, nb   <span class="Comment">!部分集合を無作為に与える。</span>
 <span class="Statement">call</span> <span class="Identifier">random_number</span>(x)
 s(i) <span class="Statement">=</span> <span class="Identifier">int</span>(x<span class="Statement">*</span>(<span class="Constant">2</span><span class="Statement">**</span>n))
 <span class="Statement">enddo</span>
 <span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, nb    <span class="Comment">!同じ集合がある場合はやり直し。</span>
  <span class="Statement">do</span> j <span class="Statement">=</span> <span class="Constant">1</span>, nb
    <span class="Statement">if</span> (i <span class="Statement">==</span> j) <span class="Statement">cycle</span>
    <span class="Statement">if</span> (s(i) <span class="Statement">==</span> s(j)) <span class="Statement">goto</span> <span class="Special">10</span>
  <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
 <span class="Statement">if</span> (loopless <span class="Statement">.eqv.</span> <span class="Constant">.true.</span>) <span class="Statement">then</span> <span class="Comment">!ループがあるかを判定する。</span>
   u <span class="Statement">=</span> s(<span class="Constant">1</span>)
   <span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">2</span>, nb
      u <span class="Statement">=</span> <span class="Identifier">ior</span>(u,s(i))
   <span class="Statement">enddo</span>
   <span class="Statement">if</span> (u <span class="Statement">/=</span> <span class="Constant">2</span><span class="Statement">**</span>n<span class="Statement">-</span><span class="Constant">1</span>) <span class="Statement">goto</span> <span class="Special">10</span>
 <span class="Statement">endif</span>
 <span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, nb    <span class="Comment">!部分集合の大きさを測る。</span>
      ns(i) <span class="Statement">=</span> <span class="Constant">0</span>
 <span class="Statement">enddo</span>
 <span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, nb
  <span class="Statement">do</span> j <span class="Statement">=</span> <span class="Constant">1</span>, n
         <span class="Statement">if</span> (<span class="Identifier">iand</span>(s(i),<span class="Constant">2</span><span class="Statement">**</span>(j<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">==</span> <span class="Constant">2</span><span class="Statement">**</span>(j<span class="Statement">-</span><span class="Constant">1</span>)) ns(i) <span class="Statement">=</span> ns(i) <span class="Statement">+</span> <span class="Constant">1</span>
  <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
 <span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, nb   <span class="Comment">!元の個数が一様でないならばやり直し。</span>
  <span class="Statement">do</span> j <span class="Statement">=</span> <span class="Constant">1</span>, nb
     <span class="Statement">if</span> (ns(i) <span class="Statement">/=</span> ns(j)) <span class="Statement">goto</span> <span class="Special">10</span>
  <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
 <span class="Statement">if</span> ((t1 <span class="Statement">.eqv.</span> <span class="Constant">.true.</span>) <span class="Statement">.and.</span> (ns(<span class="Constant">1</span>) <span class="Statement">&lt;</span> rkmin)) <span class="Statement">goto</span> <span class="Special">10</span>     <span class="Comment">!基底の最小値より小さいならばやり直し。</span>
 <span class="Statement">if</span> ((t2 <span class="Statement">.eqv.</span> <span class="Constant">.true.</span>) <span class="Statement">.and.</span> (ns(<span class="Constant">1</span>) <span class="Statement">&gt;</span> rkmax)) <span class="Statement">goto</span> <span class="Special">10</span>     <span class="Comment">!基底の最大値より大きいならばやり直し。</span>
<span class="Comment">!基底族の公理を満足するか判定する。</span>
 <span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, nb
  <span class="Statement">do</span> j <span class="Statement">=</span> <span class="Constant">1</span>, nb
  <span class="Statement">if</span> (i <span class="Statement">==</span> j) <span class="Statement">cycle</span>
  d <span class="Statement">=</span> <span class="Identifier">ieor</span>(s(i),s(j))        <span class="Comment">!s(i)とs(j)の対称差を取る。</span>
  d1 <span class="Statement">=</span> <span class="Identifier">iand</span>(d,s(i))     <span class="Comment">!s(i)からs(j)を引く。</span>
  d2 <span class="Statement">=</span> <span class="Identifier">iand</span>(d,s(j))     <span class="Comment">!s(j)からs(i)を引く。</span>
   <span class="Statement">do</span> k <span class="Statement">=</span> <span class="Constant">1</span>, n
   <span class="Statement">if</span> (<span class="Identifier">iand</span>(d1,<span class="Constant">2</span><span class="Statement">**</span>(k<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">/=</span> <span class="Constant">2</span><span class="Statement">**</span>(k<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">cycle</span>     <span class="Comment">!s(i)\s(j)の元を取る。</span>
   c <span class="Statement">=</span> <span class="Constant">.false.</span>
    <span class="Statement">do</span> l <span class="Statement">=</span> <span class="Constant">1</span>, n
     <span class="Statement">if</span> (<span class="Identifier">iand</span>(d2,<span class="Constant">2</span><span class="Statement">**</span>(l<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">/=</span> <span class="Constant">2</span><span class="Statement">**</span>(l<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">cycle</span>   <span class="Comment">!s(j)\s(j)の元を取る。</span>
     <span class="Statement">do</span> h <span class="Statement">=</span> <span class="Constant">1</span>, nb
            <span class="Statement">if</span> ((s(i) <span class="Statement">-</span> <span class="Constant">2</span><span class="Statement">**</span>(k<span class="Statement">-</span><span class="Constant">1</span>)) <span class="Statement">+</span> <span class="Constant">2</span><span class="Statement">**</span>(l<span class="Statement">-</span><span class="Constant">1</span>) <span class="Statement">==</span> s(h)) c <span class="Statement">=</span> <span class="Constant">.true.</span>        <span class="Comment">!基底の交換</span>
     <span class="Statement">enddo</span>
    <span class="Statement">enddo</span>
        <span class="Statement">if</span> (c <span class="Statement">.eqv.</span> <span class="Constant">.false.</span>) <span class="Statement">goto</span> <span class="Special">10</span>
   <span class="Statement">enddo</span>
  <span class="Statement">enddo</span>
 <span class="Statement">enddo</span>
    z <span class="Statement">=</span> <span class="Constant">.true.</span>
    <span class="Statement">exit</span>
<span class="Todo">10 enddo</span>
    <span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, nb
      <span class="Statement">print</span><span class="Constant">'(b32.32)'</span>,s(i)
    <span class="Statement">enddo</span>
    <span class="Statement">if</span> (z <span class="Statement">.eqv.</span> <span class="Constant">.true.</span>) <span class="Statement">print</span><span class="Constant">'(A6,I32)'</span>,<span class="Constant">'階数 = '</span>,ns(<span class="Constant">1</span>)
<span class="Statement">print</span><span class="Constant">'(A6,I32)'</span>,<span class="Constant">'試行回数 = '</span>,t
<span class="Statement">if</span> (z <span class="Statement">.eqv.</span> <span class="Constant">.true.</span>) <span class="Statement">print</span><span class="Constant">'(A6)'</span>,<span class="Constant">'成功'</span>
<span class="Statement">if</span> (z <span class="Statement">.eqv.</span> <span class="Constant">.false.</span>) <span class="Statement">print</span><span class="Constant">'(A6)'</span>,<span class="Constant">'失敗'</span>
<span class="PreProc">end program</span> <span class="Identifier">gen_base</span>
<span class="Comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<span class="PreProc">function</span> <span class="Identifier">binom</span>(n,k)
<span class="Type">implicit none</span>
<span class="Type">integer</span>(<span class="Constant">8</span>) binom,n,k,i
<span class="Statement">if</span> (n<span class="Statement">-</span>k <span class="Statement">&gt;</span> k) k <span class="Statement">=</span> n<span class="Statement">-</span>k
binom <span class="Statement">=</span> n
<span class="Statement">do</span> i <span class="Statement">=</span> n<span class="Statement">-</span><span class="Constant">1</span>, k <span class="Statement">+</span> <span class="Constant">1</span>,<span class="Statement">-</span><span class="Constant">1</span>
binom <span class="Statement">=</span> binom <span class="Statement">*</span> i
<span class="Statement">enddo</span>
<span class="Statement">do</span> i <span class="Statement">=</span> <span class="Constant">1</span>, n<span class="Statement">-</span>k
binom <span class="Statement">=</span> binom <span class="Statement">/</span> i
<span class="Statement">enddo</span>
<span class="PreProc">end function</span> <span class="Identifier">binom</span>
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
